<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Config.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JaCoCo Ant Example</a> &gt; <a href="index.source.html" class="el_package">net.sourceforge.schemaspy</a> &gt; <span class="el_source">Config.java</span></div><h1>Config.java</h1><pre class="source lang-java linenums">/*
 * This file is a part of the SchemaSpy project (http://schemaspy.sourceforge.net).
 * Copyright (C) 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011 John Currier
 *
 * SchemaSpy is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.
 *
 * SchemaSpy is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
 */
package net.sourceforge.schemaspy;

import java.beans.BeanInfo;
import java.beans.IntrospectionException;
import java.beans.Introspector;
import java.beans.PropertyDescriptor;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.sql.DatabaseMetaData;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;
import java.util.Properties;
import java.util.PropertyResourceBundle;
import java.util.ResourceBundle;
import java.util.Set;
import java.util.StringTokenizer;
import java.util.TreeSet;
import java.util.jar.JarEntry;
import java.util.jar.JarInputStream;
import java.util.logging.Level;
import java.util.regex.Pattern;
import java.util.regex.PatternSyntaxException;
import net.sourceforge.schemaspy.model.InvalidConfigurationException;
import net.sourceforge.schemaspy.util.DbSpecificConfig;
import net.sourceforge.schemaspy.util.Dot;
import net.sourceforge.schemaspy.util.PasswordReader;
import net.sourceforge.schemaspy.view.DefaultSqlFormatter;
import net.sourceforge.schemaspy.view.SqlFormatter;

/**
 * Configuration of a SchemaSpy run
 *
 * @author John Currier
 */
public class Config
{
    private static Config instance;
    private final List&lt;String&gt; options;
    private Map&lt;String, String&gt; dbSpecificOptions;
    private Map&lt;String, String&gt; originalDbSpecificOptions;
    private boolean helpRequired;
    private boolean dbHelpRequired;
    private File outputDir;
    private File graphvizDir;
    private String dbType;
    private String catalog;
    private String schema;
    private List&lt;String&gt; schemas;
    private String user;
    private Boolean singleSignOn;
    private Boolean noSchema;
    private String password;
    private Boolean promptForPassword;
    private String db;
    private String host;
    private Integer port;
    private String server;
    private String meta;
    private Pattern tableInclusions;
    private Pattern tableExclusions;
    private Pattern columnExclusions;
    private Pattern indirectColumnExclusions;
    private String userConnectionPropertiesFile;
    private Properties userConnectionProperties;
    private Integer maxDbThreads;
    private Integer maxDetailedTables;
    private String driverPath;
    private String css;
    private String charset;
    private String font;
    private Integer fontSize;
    private String description;
    private Properties dbProperties;
    private String dbPropertiesLoadedFrom;
    private Level logLevel;
    private SqlFormatter sqlFormatter;
    private String sqlFormatterClass;
    private Boolean generateHtml;
    private Boolean includeImpliedConstraints;
    private Boolean logoEnabled;
    private Boolean rankDirBugEnabled;
    private Boolean encodeCommentsEnabled;
    private Boolean numRowsEnabled;
    private Boolean viewsEnabled;
    private Boolean meterEnabled;
    private Boolean railsEnabled;
    private Boolean evaluteAll;
    private Boolean highQuality;
    private Boolean lowQuality;
    private String schemaSpec;  // used in conjunction with evaluateAll
<span class="fc" id="L119">    private boolean hasOrphans = false;</span>
<span class="fc" id="L120">    private boolean hasRoutines = false;</span>
<span class="fc" id="L121">    private boolean populating = false;</span>
    private List&lt;String&gt; columnDetails;
    public static final String DOT_CHARSET = &quot;UTF-8&quot;;
    private static final String ESCAPED_EQUALS = &quot;\\=&quot;;
    private static final String DEFAULT_TABLE_INCLUSION = &quot;.*&quot;; // match everything
    private static final String DEFAULT_TABLE_EXCLUSION = &quot;&quot;;   // match nothing
    private static final String DEFAULT_COLUMN_EXCLUSION = &quot;[^.]&quot;;  // match nothing

    /**
     * Default constructor. Intended for when you want to inject properties
     * independently (i.e. not from a command line interface).
     */
    public Config()
<span class="fc" id="L134">    {</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">        if (instance == null)</span>
<span class="fc" id="L136">            setInstance(this);</span>
<span class="fc" id="L137">        options = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L138">    }</span>

    /**
     * Construct a configuration from an array of options (e.g. from a command
     * line interface).
     *
     * @param options
     */
    public Config(String[] argv)
<span class="fc" id="L147">    {</span>
<span class="fc" id="L148">        setInstance(this);</span>
<span class="fc" id="L149">        options = fixupArgs(Arrays.asList(argv));</span>

<span class="pc bpc" id="L151" title="6 of 12 branches missed.">        helpRequired =  options.remove(&quot;-?&quot;) ||</span>
                        options.remove(&quot;/?&quot;) ||
                        options.remove(&quot;?&quot;) ||
                        options.remove(&quot;-h&quot;) ||
                        options.remove(&quot;-help&quot;) ||
                        options.remove(&quot;--help&quot;);
<span class="pc bpc" id="L157" title="2 of 4 branches missed.">        dbHelpRequired =  options.remove(&quot;-dbHelp&quot;) || options.remove(&quot;-dbhelp&quot;);</span>
<span class="fc" id="L158">    }</span>

    public static Config getInstance() {
<span class="fc bfc" id="L161" title="All 2 branches covered.">        if (instance == null)</span>
<span class="fc" id="L162">            instance = new Config();</span>

<span class="fc" id="L164">        return instance;</span>
    }

    /**
     * Sets the global instance.
     *
     * Useful for things like selecting a specific configuration in a UI.
     *
     * @param config
     */
    public static void setInstance(Config config) {
<span class="fc" id="L175">        instance = config;</span>
<span class="fc" id="L176">    }</span>

    public void setHtmlGenerationEnabled(boolean generateHtml) {
<span class="fc" id="L179">        this.generateHtml = generateHtml;</span>
<span class="fc" id="L180">    }</span>

    public boolean isHtmlGenerationEnabled() {
<span class="fc bfc" id="L183" title="All 2 branches covered.">        if (generateHtml == null)</span>
<span class="pc bpc" id="L184" title="1 of 2 branches missed.">            generateHtml = !options.remove(&quot;-nohtml&quot;);</span>

<span class="fc" id="L186">        return generateHtml;</span>
    }

    public void setImpliedConstraintsEnabled(boolean includeImpliedConstraints) {
<span class="fc" id="L190">        this.includeImpliedConstraints = includeImpliedConstraints;</span>
<span class="fc" id="L191">    }</span>

    public boolean isImpliedConstraintsEnabled() {
<span class="fc bfc" id="L194" title="All 2 branches covered.">        if (includeImpliedConstraints == null)</span>
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">            includeImpliedConstraints = !options.remove(&quot;-noimplied&quot;);</span>

<span class="fc" id="L197">        return includeImpliedConstraints;</span>
    }

    public void setOutputDir(String outputDirName) {
<span class="pc bpc" id="L201" title="1 of 2 branches missed.">        if (outputDirName.endsWith(&quot;\&quot;&quot;))</span>
<span class="fc" id="L202">            outputDirName = outputDirName.substring(0, outputDirName.length() - 1);</span>

<span class="fc" id="L204">        setOutputDir(new File(outputDirName));</span>
<span class="fc" id="L205">    }</span>

    public void setOutputDir(File outputDir) {
<span class="fc" id="L208">        this.outputDir = outputDir;</span>
<span class="fc" id="L209">    }</span>

    public File getOutputDir() {
<span class="nc bnc" id="L212" title="All 2 branches missed.">        if (outputDir == null) {</span>
<span class="nc" id="L213">            setOutputDir(pullRequiredParam(&quot;-o&quot;));</span>
        }

<span class="nc" id="L216">        return outputDir;</span>
    }

    /**
     * Set the path to Graphviz so we can find dot to generate ER diagrams
     *
     * @param graphvizDir
     */
    public void setGraphvizDir(String graphvizDir) {
<span class="pc bpc" id="L225" title="1 of 2 branches missed.">        if (graphvizDir.endsWith(&quot;\&quot;&quot;))</span>
<span class="fc" id="L226">            graphvizDir = graphvizDir.substring(0, graphvizDir.length() - 1);</span>

<span class="fc" id="L228">        setGraphvizDir(new File(graphvizDir));</span>
<span class="fc" id="L229">    }</span>

    /**
     * Set the path to Graphviz so we can find dot to generate ER diagrams
     *
     * @param graphvizDir
     */
    public void setGraphvizDir(File graphvizDir) {
<span class="fc" id="L237">        this.graphvizDir = graphvizDir;</span>
<span class="fc" id="L238">    }</span>

    /**
     * Return the path to Graphviz (used to find the dot executable to run to
     * generate ER diagrams).&lt;p/&gt;
     *
     * Returns {@link #getDefaultGraphvizPath()} if a specific Graphviz path
     * was not specified.
     *
     * @return
     */
    public File getGraphvizDir() {
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">        if (graphvizDir == null) {</span>
<span class="fc" id="L251">            String gv = pullParam(&quot;-gv&quot;);</span>
<span class="pc bpc" id="L252" title="1 of 2 branches missed.">            if (gv != null) {</span>
<span class="nc" id="L253">                setGraphvizDir(gv);</span>
            } else {
                // expect to find Graphviz's bin directory on the PATH
            }
        }

<span class="fc" id="L259">        return graphvizDir;</span>
    }

    /**
     * Meta files are XML-based files that provide additional metadata
     * about the schema being evaluated.&lt;p&gt;
     * &lt;code&gt;meta&lt;/code&gt; is either the name of an individual XML file or
     * the directory that contains meta files.&lt;p&gt;
     * If a directory is specified then it is expected to contain files
     * matching the pattern &lt;code&gt;[schema].meta.xml&lt;/code&gt;.
     * For databases that don't have schema substitute database for schema.
     * @param meta
     */
    public void setMeta(String meta) {
<span class="fc" id="L273">        this.meta = meta;</span>
<span class="fc" id="L274">    }</span>

    public String getMeta() {
<span class="pc bpc" id="L277" title="1 of 2 branches missed.">        if (meta == null)</span>
<span class="fc" id="L278">            meta = pullParam(&quot;-meta&quot;);</span>
<span class="fc" id="L279">        return meta;</span>
    }

    public void setDbType(String dbType) {
<span class="fc" id="L283">        this.dbType = dbType;</span>
<span class="fc" id="L284">    }</span>

    public String getDbType() {
<span class="fc bfc" id="L287" title="All 2 branches covered.">        if (dbType == null) {</span>
<span class="fc" id="L288">            dbType = pullParam(&quot;-t&quot;);</span>
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">            if (dbType == null)</span>
<span class="fc" id="L290">                dbType = &quot;ora&quot;;</span>
        }

<span class="fc" id="L293">        return dbType;</span>
    }

    public void setDb(String db) {
<span class="fc" id="L297">        this.db = db;</span>
<span class="fc" id="L298">    }</span>

    public String getDb() {
<span class="pc bpc" id="L301" title="1 of 2 branches missed.">        if (db == null)</span>
<span class="fc" id="L302">            db = pullParam(&quot;-db&quot;);</span>
<span class="fc" id="L303">        return db;</span>
    }

    public void setCatalog(String catalog) {
<span class="fc" id="L307">        this.catalog = catalog;</span>
<span class="fc" id="L308">    }</span>

    public String getCatalog() {
<span class="pc bpc" id="L311" title="1 of 2 branches missed.">        if (catalog == null)</span>
<span class="fc" id="L312">            catalog = pullParam(&quot;-cat&quot;);</span>
<span class="fc" id="L313">        return catalog;</span>
    }

    public void setSchema(String schema) {
<span class="fc" id="L317">        this.schema = schema;</span>
<span class="fc" id="L318">    }</span>

    public String getSchema() {
<span class="fc bfc" id="L321" title="All 2 branches covered.">        if (schema == null)</span>
<span class="fc" id="L322">            schema = pullParam(&quot;-s&quot;);</span>
<span class="fc" id="L323">        return schema;</span>
    }

    /**
     * Some databases types (e.g. older versions of Informix) don't really
     * have the concept of a schema but still return true from
     * {@link DatabaseMetaData#supportsSchemasInTableDefinitions()}.
     * This option lets you ignore that and treat all the tables
     * as if they were in one flat namespace.
     */
    public boolean isSchemaDisabled() {
<span class="fc bfc" id="L334" title="All 2 branches covered.">        if (noSchema == null)</span>
<span class="fc" id="L335">            noSchema = options.remove(&quot;-noschema&quot;);</span>

<span class="fc" id="L337">        return noSchema;</span>
    }

    public void setHost(String host) {
<span class="fc" id="L341">        this.host = host;</span>
<span class="fc" id="L342">    }</span>

    public String getHost() {
<span class="pc bpc" id="L345" title="1 of 2 branches missed.">        if (host == null)</span>
<span class="fc" id="L346">            host = pullParam(&quot;-host&quot;);</span>
<span class="fc" id="L347">        return host;</span>
    }

    public void setPort(Integer port) {
<span class="fc" id="L351">        this.port = port;</span>
<span class="fc" id="L352">    }</span>

    public Integer getPort() {
<span class="pc bpc" id="L355" title="1 of 2 branches missed.">        if (port == null)</span>
            try {
<span class="nc" id="L357">                port = Integer.valueOf(pullParam(&quot;-port&quot;));</span>
<span class="pc" id="L358">            } catch (Exception notSpecified) {}</span>
<span class="fc" id="L359">        return port;</span>
    }

    public void setServer(String server) {
<span class="fc" id="L363">        this.server = server;</span>
<span class="fc" id="L364">    }</span>

    public String getServer() {
<span class="pc bpc" id="L367" title="1 of 2 branches missed.">        if (server == null) {</span>
<span class="fc" id="L368">            server = pullParam(&quot;-server&quot;);</span>
        }

<span class="fc" id="L371">        return server;</span>
    }

    public void setUser(String user) {
<span class="fc" id="L375">        this.user = user;</span>
<span class="fc" id="L376">    }</span>

    /**
     * User used to connect to the database.
     * Required unless single sign-on is enabled
     * (see {@link #setSingleSignOn(boolean)}).
     * @return
     */
    public String getUser() {
<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (user == null) {</span>
<span class="nc bnc" id="L386" title="All 2 branches missed.">            if (!isSingleSignOn())</span>
<span class="nc" id="L387">                user = pullRequiredParam(&quot;-u&quot;);</span>
            else
<span class="nc" id="L389">                user = pullParam(&quot;-u&quot;);</span>
        }
<span class="nc" id="L391">        return user;</span>
    }

    /**
     * By default a &quot;user&quot; (as specified with -u) is required.
     * This option allows disabling of that requirement for
     * single sign-on environments.
     *
     * @param enabled defaults to &lt;code&gt;false&lt;/code&gt;
     */
    public void setSingleSignOn(boolean enabled) {
<span class="fc" id="L402">        singleSignOn = enabled;</span>
<span class="fc" id="L403">    }</span>

    /**
     * @see #setSingleSignOn(boolean)
     */
    public boolean isSingleSignOn() {
<span class="fc bfc" id="L409" title="All 2 branches covered.">        if (singleSignOn == null)</span>
<span class="fc" id="L410">            singleSignOn = options.remove(&quot;-sso&quot;);</span>

<span class="fc" id="L412">        return singleSignOn;</span>
    }

    /**
     * Set the password used to connect to the database.
     * @param password
     */
    public void setPassword(String password) {
<span class="fc" id="L420">        this.password = password;</span>
<span class="fc" id="L421">    }</span>

    /**
     * @see #setPassword(String)
     * @return
     */
    public String getPassword() {
<span class="pc bpc" id="L428" title="1 of 2 branches missed.">        if (password == null)</span>
<span class="fc" id="L429">            password = pullParam(&quot;-p&quot;);</span>

<span class="pc bpc" id="L431" title="2 of 4 branches missed.">        if (password == null &amp;&amp; isPromptForPasswordEnabled())</span>
<span class="nc" id="L432">            password = new String(PasswordReader.getInstance().readPassword(&quot;Password: &quot;));</span>

<span class="pc bpc" id="L434" title="1 of 2 branches missed.">        if (password == null) {</span>
            // if -pfp is enabled when analyzing multiple schemas then
            // we don't want to send the password on the command line,
            // so see if it was passed in the environment (not ideal, but safer)
<span class="fc" id="L438">            password = System.getenv(&quot;schemaspy.pw&quot;);</span>
        }

<span class="fc" id="L441">        return password;</span>
    }

    /**
     * Set to &lt;code&gt;true&lt;/code&gt; to prompt for the password
     * @param promptForPassword
     */
    public void setPromptForPasswordEnabled(boolean promptForPassword) {
<span class="fc" id="L449">        this.promptForPassword = promptForPassword;</span>
<span class="fc" id="L450">    }</span>

    /**
     * @see #setPromptForPasswordEnabled(boolean)
     * @return
     */
    public boolean isPromptForPasswordEnabled() {
<span class="fc bfc" id="L457" title="All 2 branches covered.">        if (promptForPassword == null) {</span>
<span class="fc" id="L458">            promptForPassword = options.remove(&quot;-pfp&quot;);</span>
        }

<span class="fc" id="L461">        return promptForPassword;</span>
    }

    public void setMaxDetailedTabled(int maxDetailedTables) {
<span class="fc" id="L465">        this.maxDetailedTables = new Integer(maxDetailedTables);</span>
<span class="fc" id="L466">    }</span>

    public int getMaxDetailedTables() {
<span class="pc bpc" id="L469" title="1 of 2 branches missed.">        if (maxDetailedTables == null) {</span>
<span class="fc" id="L470">            int max = 300; // default</span>
            try {
<span class="nc" id="L472">                max = Integer.parseInt(pullParam(&quot;-maxdet&quot;));</span>
<span class="pc" id="L473">            } catch (Exception notSpecified) {}</span>

<span class="fc" id="L475">            maxDetailedTables = new Integer(max);</span>
        }

<span class="fc" id="L478">        return maxDetailedTables.intValue();</span>
    }

    public String getConnectionPropertiesFile() {
<span class="fc" id="L482">        return userConnectionPropertiesFile;</span>
    }

    /**
     * Properties from this file (in key=value pair format) are passed to the
     * database connection.&lt;br&gt;
     * user (from -u) and password (from -p) will be passed in the
     * connection properties if specified.
     * @param propertiesFilename
     * @throws FileNotFoundException
     * @throws IOException
     */
    public void setConnectionPropertiesFile(String propertiesFilename) throws FileNotFoundException, IOException {
<span class="pc bpc" id="L495" title="1 of 2 branches missed.">        if (userConnectionProperties == null)</span>
<span class="fc" id="L496">            userConnectionProperties = new Properties();</span>
<span class="nc" id="L497">        userConnectionProperties.load(new FileInputStream(propertiesFilename));</span>
<span class="nc" id="L498">        userConnectionPropertiesFile = propertiesFilename;</span>
<span class="nc" id="L499">    }</span>

    /**
     * Returns a {@link Properties} populated either from the properties file specified
     * by {@link #setConnectionPropertiesFile(String)}, the properties specified by
     * {@link #setConnectionProperties(String)} or not populated.
     * @return
     * @throws FileNotFoundException
     * @throws IOException
     */
    public Properties getConnectionProperties() throws FileNotFoundException, IOException {
<span class="fc bfc" id="L510" title="All 2 branches covered.">        if (userConnectionProperties == null) {</span>
<span class="fc" id="L511">            String props = pullParam(&quot;-connprops&quot;);</span>
<span class="pc bpc" id="L512" title="1 of 2 branches missed.">            if (props != null) {</span>
<span class="nc bnc" id="L513" title="All 2 branches missed.">                if (props.indexOf(ESCAPED_EQUALS) != -1) {</span>
<span class="nc" id="L514">                    setConnectionProperties(props);</span>
                } else {
<span class="nc" id="L516">                    setConnectionPropertiesFile(props);</span>
                }
            } else {
<span class="fc" id="L519">                userConnectionProperties = new Properties();</span>
            }
        }

<span class="fc" id="L523">        return userConnectionProperties;</span>
    }

    /**
     * Specifies connection properties to use in the format:
     * &lt;code&gt;key1\=value1;key2\=value2&lt;/code&gt;&lt;br&gt;
     * user (from -u) and password (from -p) will be passed in the
     * connection properties if specified.&lt;p&gt;
     * This is an alternative form of passing connection properties than by file
     * (see {@link #setConnectionPropertiesFile(String)})
     *
     * @param properties
     */
    public void setConnectionProperties(String properties) {
<span class="fc" id="L537">        userConnectionProperties = new Properties();</span>

<span class="fc" id="L539">        StringTokenizer tokenizer = new StringTokenizer(properties, &quot;;&quot;);</span>
<span class="fc bfc" id="L540" title="All 2 branches covered.">        while (tokenizer.hasMoreElements()) {</span>
<span class="fc" id="L541">            String pair = tokenizer.nextToken();</span>
<span class="fc" id="L542">            int index = pair.indexOf(ESCAPED_EQUALS);</span>
<span class="pc bpc" id="L543" title="1 of 2 branches missed.">            if (index != -1) {</span>
<span class="nc" id="L544">                String key = pair.substring(0, index);</span>
<span class="nc" id="L545">                String value = pair.substring(index + ESCAPED_EQUALS.length());</span>
<span class="nc" id="L546">                userConnectionProperties.put(key, value);</span>
            }
<span class="fc" id="L548">        }</span>
<span class="fc" id="L549">    }</span>

    public void setDriverPath(String driverPath) {
<span class="fc" id="L552">        this.driverPath = driverPath;</span>
<span class="fc" id="L553">    }</span>

    public String getDriverPath() {
<span class="pc bpc" id="L556" title="1 of 2 branches missed.">        if (driverPath == null)</span>
<span class="fc" id="L557">            driverPath = pullParam(&quot;-dp&quot;);</span>

        // was previously -cp:
<span class="pc bpc" id="L560" title="1 of 2 branches missed.">        if (driverPath == null)</span>
<span class="fc" id="L561">            driverPath = pullParam(&quot;-cp&quot;);</span>

<span class="fc" id="L563">        return driverPath;</span>
    }

    /**
     * The filename of the cascading style sheet to use.
     * Note that this file is parsed and used to determine characteristics
     * of the generated diagrams, so it must contain specific settings that
     * are documented within schemaSpy.css.&lt;p&gt;
     *
     * Defaults to &lt;code&gt;&quot;schemaSpy.css&quot;&lt;/code&gt;.
     *
     * @param css
     */
    public void setCss(String css) {
<span class="fc" id="L577">        this.css = css;</span>
<span class="fc" id="L578">    }</span>

    public String getCss() {
<span class="fc bfc" id="L581" title="All 2 branches covered.">        if (css == null) {</span>
<span class="fc" id="L582">            css = pullParam(&quot;-css&quot;);</span>
<span class="pc bpc" id="L583" title="1 of 2 branches missed.">            if (css == null)</span>
<span class="fc" id="L584">                css = &quot;schemaSpy.css&quot;;</span>
        }
<span class="fc" id="L586">        return css;</span>
    }

    /**
     * The font to use within diagrams.  Modify the .css to specify HTML fonts.
     *
     * @param font
     */
    public void setFont(String font) {
<span class="fc" id="L595">        this.font = font;</span>
<span class="fc" id="L596">    }</span>

    /**
     * @see #setFont(String)
     */
    public String getFont() {
<span class="fc bfc" id="L602" title="All 2 branches covered.">        if (font == null) {</span>
<span class="fc" id="L603">            font = pullParam(&quot;-font&quot;);</span>
<span class="pc bpc" id="L604" title="1 of 2 branches missed.">            if (font == null)</span>
<span class="fc" id="L605">                font = &quot;Helvetica&quot;;</span>
        }
<span class="fc" id="L607">        return font;</span>
    }

    /**
     * The font size to use within diagrams.  This is the size of the font used for
     * 'large' (e.g. not 'compact') diagrams.&lt;p&gt;
     *
     * Modify the .css to specify HTML font sizes.&lt;p&gt;
     *
     * Defaults to 11.
     *
     * @param fontSize
     */
    public void setFontSize(int fontSize) {
<span class="fc" id="L621">        this.fontSize = new Integer(fontSize);</span>
<span class="fc" id="L622">    }</span>

    /**
     * @see #setFontSize(int)
     * @return
     */
    public int getFontSize() {
<span class="fc bfc" id="L629" title="All 2 branches covered.">        if (fontSize == null) {</span>
<span class="fc" id="L630">            int size = 11; // default</span>
            try {
<span class="nc" id="L632">                size = Integer.parseInt(pullParam(&quot;-fontsize&quot;));</span>
<span class="pc" id="L633">            } catch (Exception notSpecified) {}</span>

<span class="fc" id="L635">            fontSize = new Integer(size);</span>
        }

<span class="fc" id="L638">        return fontSize.intValue();</span>
    }

    /**
     * The character set to use within HTML pages (defaults to &lt;code&gt;&quot;ISO-8859-1&quot;&lt;/code&gt;).
     *
     * @param charset
     */
    public void setCharset(String charset) {
<span class="fc" id="L647">        this.charset = charset;</span>
<span class="fc" id="L648">    }</span>

    /**
     * @see #setCharset(String)
     */
    public String getCharset() {
<span class="fc bfc" id="L654" title="All 2 branches covered.">        if (charset == null) {</span>
<span class="fc" id="L655">            charset = pullParam(&quot;-charset&quot;);</span>
<span class="pc bpc" id="L656" title="1 of 2 branches missed.">            if (charset == null)</span>
<span class="fc" id="L657">                charset = &quot;ISO-8859-1&quot;;</span>
        }
<span class="fc" id="L659">        return charset;</span>
    }

    /**
     * Description of schema that gets display on main pages.
     *
     * @param description
     */
    public void setDescription(String description) {
<span class="fc" id="L668">        this.description = description;</span>
<span class="fc" id="L669">    }</span>

    /**
     * @see #setDescription(String)
     */
    public String getDescription() {
<span class="pc bpc" id="L675" title="1 of 2 branches missed.">        if (description == null)</span>
<span class="fc" id="L676">            description = pullParam(&quot;-desc&quot;);</span>
<span class="fc" id="L677">        return description;</span>
    }

    /**
     * Maximum number of threads to use when querying database metadata information.
     *
     * @param maxDbThreads
     */
    public void setMaxDbThreads(int maxDbThreads) {
<span class="fc" id="L686">        this.maxDbThreads = new Integer(maxDbThreads);</span>
<span class="fc" id="L687">    }</span>

    /**
     * @see #setMaxDbThreads(int)
     * @throws InvalidConfigurationException if unable to load properties
     */
    public int getMaxDbThreads() throws InvalidConfigurationException {
<span class="fc bfc" id="L694" title="All 2 branches covered.">        if (maxDbThreads == null) {</span>
            Properties properties;
            try {
<span class="nc" id="L697">                properties = determineDbProperties(getDbType());</span>
<span class="fc" id="L698">            } catch (IOException exc) {</span>
<span class="fc" id="L699">                throw new InvalidConfigurationException(&quot;Failed to load properties for &quot; + getDbType() + &quot;: &quot; + exc)</span>
                                .setParamName(&quot;-type&quot;);
<span class="nc" id="L701">            }</span>

<span class="nc" id="L703">            final int defaultMax = 15;  // not scientifically derived</span>
<span class="nc" id="L704">            int max = defaultMax;</span>
<span class="nc" id="L705">            String threads = properties.getProperty(&quot;dbThreads&quot;);</span>
<span class="nc bnc" id="L706" title="All 2 branches missed.">            if (threads == null)</span>
<span class="nc" id="L707">                threads = properties.getProperty(&quot;dbthreads&quot;);</span>
<span class="nc bnc" id="L708" title="All 2 branches missed.">            if (threads != null)</span>
<span class="nc" id="L709">                max = Integer.parseInt(threads);</span>
<span class="nc" id="L710">            threads = pullParam(&quot;-dbThreads&quot;);</span>
<span class="nc bnc" id="L711" title="All 2 branches missed.">            if (threads == null)</span>
<span class="nc" id="L712">                threads = pullParam(&quot;-dbthreads&quot;);</span>
<span class="nc bnc" id="L713" title="All 2 branches missed.">            if (threads != null)</span>
<span class="nc" id="L714">                max = Integer.parseInt(threads);</span>
<span class="nc bnc" id="L715" title="All 2 branches missed.">            if (max &lt; 0)</span>
<span class="nc" id="L716">                max = defaultMax;</span>
<span class="nc bnc" id="L717" title="All 2 branches missed.">            else if (max == 0)</span>
<span class="nc" id="L718">                max = 1;</span>

<span class="nc" id="L720">            maxDbThreads = new Integer(max);</span>
        }

<span class="fc" id="L723">        return maxDbThreads.intValue();</span>
    }

    public boolean isLogoEnabled() {
<span class="fc bfc" id="L727" title="All 2 branches covered.">        if (logoEnabled == null)</span>
<span class="pc bpc" id="L728" title="1 of 2 branches missed.">            logoEnabled = !options.remove(&quot;-nologo&quot;);</span>

<span class="fc" id="L730">        return logoEnabled;</span>
    }

    /**
     * Don't use this unless absolutely necessary as it screws up the layout
     *
     * @param enabled
     */
    public void setRankDirBugEnabled(boolean enabled) {
<span class="fc" id="L739">        rankDirBugEnabled = enabled;</span>
<span class="fc" id="L740">    }</span>

    /**
     * @see #setRankDirBugEnabled(boolean)
     */
    public boolean isRankDirBugEnabled() {
<span class="fc bfc" id="L746" title="All 2 branches covered.">        if (rankDirBugEnabled == null)</span>
<span class="fc" id="L747">            rankDirBugEnabled = options.remove(&quot;-rankdirbug&quot;);</span>

<span class="fc" id="L749">        return rankDirBugEnabled;</span>
    }

    /**
     * Look for Ruby on Rails-based naming conventions in
     * relationships between logical foreign keys and primary keys.&lt;p&gt;
     *
     * Basically all tables have a primary key named &lt;code&gt;ID&lt;/code&gt;.
     * All tables are named plural names.
     * The columns that logically reference that &lt;code&gt;ID&lt;/code&gt; are the singular
     * form of the table name suffixed with &lt;code&gt;_ID&lt;/code&gt;.&lt;p&gt;
     *
     * @param enabled
     */
    public void setRailsEnabled(boolean enabled) {
<span class="fc" id="L764">        railsEnabled = enabled;</span>
<span class="fc" id="L765">    }</span>

    /**
     * @see #setRailsEnabled(boolean)
     *
     * @return
     */
    public boolean isRailsEnabled() {
<span class="fc bfc" id="L773" title="All 2 branches covered.">        if (railsEnabled == null)</span>
<span class="fc" id="L774">            railsEnabled = options.remove(&quot;-rails&quot;);</span>

<span class="fc" id="L776">        return railsEnabled;</span>
    }

    /**
     * Allow Html In Comments - encode them unless otherwise specified
     */
    public void setEncodeCommentsEnabled(boolean enabled) {
<span class="fc" id="L783">        encodeCommentsEnabled = enabled;</span>
<span class="fc" id="L784">    }</span>

    /**
     * @see #setEncodeCommentsEnabled(boolean)
     */
    public boolean isEncodeCommentsEnabled() {
<span class="fc bfc" id="L790" title="All 2 branches covered.">        if (encodeCommentsEnabled == null)</span>
<span class="pc bpc" id="L791" title="1 of 2 branches missed.">            encodeCommentsEnabled = !options.remove(&quot;-ahic&quot;);</span>

<span class="fc" id="L793">        return encodeCommentsEnabled;</span>
    }

    /**
     * If enabled we'll attempt to query/render the number of rows that
     * each table contains.&lt;p/&gt;
     *
     * Defaults to &lt;code&gt;true&lt;/code&gt; (enabled).
     *
     * @param enabled
     */
    public void setNumRowsEnabled(boolean enabled) {
<span class="fc" id="L805">        numRowsEnabled = enabled;</span>
<span class="fc" id="L806">    }</span>

    /**
     * @see #setNumRowsEnabled(boolean)
     * @return
     */
    public boolean isNumRowsEnabled() {
<span class="fc bfc" id="L813" title="All 2 branches covered.">        if (numRowsEnabled == null)</span>
<span class="pc bpc" id="L814" title="1 of 2 branches missed.">            numRowsEnabled = !options.remove(&quot;-norows&quot;);</span>

<span class="fc" id="L816">        return numRowsEnabled;</span>
    }

    /**
     * If enabled we'll include views in the analysis.&lt;p/&gt;
     *
     * Defaults to &lt;code&gt;true&lt;/code&gt; (enabled).
     *
     * @param enabled
     */
    public void setViewsEnabled(boolean enabled) {
<span class="fc" id="L827">        viewsEnabled = enabled;</span>
<span class="fc" id="L828">    }</span>

    /**
     * @see #setViewsEnabled(boolean)
     * @return
     */
    public boolean isViewsEnabled() {
<span class="fc bfc" id="L835" title="All 2 branches covered.">        if (viewsEnabled == null)</span>
<span class="pc bpc" id="L836" title="1 of 2 branches missed.">            viewsEnabled = !options.remove(&quot;-noviews&quot;);</span>

<span class="fc" id="L838">        return viewsEnabled;</span>
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if metering should be embedded in
     * the generated pages.&lt;p/&gt;
     * Defaults to &lt;code&gt;false&lt;/code&gt; (disabled).
     * @return
     */
    public boolean isMeterEnabled() {
<span class="fc bfc" id="L848" title="All 2 branches covered.">        if (meterEnabled == null)</span>
<span class="fc" id="L849">            meterEnabled = options.remove(&quot;-meter&quot;);</span>

<span class="fc" id="L851">        return meterEnabled;</span>
    }

    /**
     * Set the columns to exclude from all relationship diagrams.
     *
     * @param columnExclusions regular expression of the columns to
     *        exclude
     */
    public void setColumnExclusions(String columnExclusions) {
<span class="fc" id="L861">        this.columnExclusions = Pattern.compile(columnExclusions);</span>
<span class="fc" id="L862">    }</span>

    /**
     * See {@link #setColumnExclusions(String)}
     * @return
     */
    public Pattern getColumnExclusions() {
<span class="fc bfc" id="L869" title="All 2 branches covered.">        if (columnExclusions == null) {</span>
<span class="fc" id="L870">            String strExclusions = pullParam(&quot;-X&quot;);</span>
<span class="pc bpc" id="L871" title="1 of 2 branches missed.">            if (strExclusions == null)</span>
<span class="fc" id="L872">                strExclusions = System.getenv(&quot;schemaspy.columnExclusions&quot;);</span>
<span class="pc bpc" id="L873" title="1 of 2 branches missed.">            if (strExclusions == null)</span>
<span class="fc" id="L874">                strExclusions = DEFAULT_COLUMN_EXCLUSION;</span>

<span class="fc" id="L876">            columnExclusions = Pattern.compile(strExclusions);</span>
        }

<span class="fc" id="L879">        return columnExclusions;</span>
    }

    /**
     * Set the columns to exclude from relationship diagrams where the specified
     * columns aren't directly referenced by the focal table.
     *
     * @param columnExclusions regular expression of the columns to
     *        exclude
     */
    public void setIndirectColumnExclusions(String fullColumnExclusions) {
<span class="fc" id="L890">        indirectColumnExclusions = Pattern.compile(fullColumnExclusions);</span>
<span class="fc" id="L891">    }</span>

    /**
     * @see #setIndirectColumnExclusions(String)
     *
     * @return
     */
    public Pattern getIndirectColumnExclusions() {
<span class="pc bpc" id="L899" title="1 of 2 branches missed.">        if (indirectColumnExclusions == null) {</span>
<span class="fc" id="L900">            String strExclusions = pullParam(&quot;-x&quot;);</span>
<span class="pc bpc" id="L901" title="1 of 2 branches missed.">            if (strExclusions == null)</span>
<span class="fc" id="L902">                strExclusions = System.getenv(&quot;schemaspy.indirectColumnExclusions&quot;);</span>
<span class="pc bpc" id="L903" title="1 of 2 branches missed.">            if (strExclusions == null)</span>
<span class="fc" id="L904">                strExclusions = DEFAULT_COLUMN_EXCLUSION;</span>

<span class="fc" id="L906">            indirectColumnExclusions = Pattern.compile(strExclusions);</span>
        }

<span class="fc" id="L909">        return indirectColumnExclusions;</span>
    }

    /**
     * Set the tables to include as a regular expression
     * @param tableInclusions
     */
    public void setTableInclusions(String tableInclusions) {
<span class="fc" id="L917">        this.tableInclusions = Pattern.compile(tableInclusions);</span>
<span class="fc" id="L918">    }</span>

    /**
     * Get the regex {@link Pattern} for which tables to include in the analysis.
     *
     * @return
     */
    public Pattern getTableInclusions() {
<span class="pc bpc" id="L926" title="1 of 2 branches missed.">        if (tableInclusions == null) {</span>
<span class="fc" id="L927">            String strInclusions = pullParam(&quot;-i&quot;);</span>
<span class="pc bpc" id="L928" title="1 of 2 branches missed.">            if (strInclusions == null)</span>
<span class="fc" id="L929">                strInclusions = System.getenv(&quot;schemaspy.tableInclusions&quot;);</span>
<span class="pc bpc" id="L930" title="1 of 2 branches missed.">            if (strInclusions == null)</span>
<span class="fc" id="L931">                strInclusions = DEFAULT_TABLE_INCLUSION;</span>

            try {
<span class="fc" id="L934">                tableInclusions = Pattern.compile(strInclusions);</span>
<span class="nc" id="L935">            } catch (PatternSyntaxException badPattern) {</span>
<span class="nc" id="L936">                throw new InvalidConfigurationException(badPattern).setParamName(&quot;-i&quot;);</span>
<span class="fc" id="L937">            }</span>
        }

<span class="fc" id="L940">        return tableInclusions;</span>
    }

    /**
     * Set the tables to exclude as a regular expression
     * @param tableInclusions
     */
    public void setTableExclusions(String tableExclusions) {
<span class="fc" id="L948">        this.tableExclusions = Pattern.compile(tableExclusions);</span>
<span class="fc" id="L949">    }</span>

    /**
     * Get the regex {@link Pattern} for which tables to exclude from the analysis.
     *
     * @return
     */
    public Pattern getTableExclusions() {
<span class="pc bpc" id="L957" title="1 of 2 branches missed.">        if (tableExclusions == null) {</span>
<span class="fc" id="L958">            String strExclusions = pullParam(&quot;-I&quot;);</span>
<span class="pc bpc" id="L959" title="1 of 2 branches missed.">            if (strExclusions == null)</span>
<span class="fc" id="L960">                strExclusions = System.getenv(&quot;schemaspy.tableExclusions&quot;);</span>
<span class="pc bpc" id="L961" title="1 of 2 branches missed.">            if (strExclusions == null)</span>
<span class="fc" id="L962">                strExclusions = DEFAULT_TABLE_EXCLUSION;</span>

            try {
<span class="fc" id="L965">                tableExclusions = Pattern.compile(strExclusions);</span>
<span class="nc" id="L966">            } catch (PatternSyntaxException badPattern) {</span>
<span class="nc" id="L967">                throw new InvalidConfigurationException(badPattern).setParamName(&quot;-I&quot;);</span>
<span class="fc" id="L968">            }</span>
        }

<span class="fc" id="L971">        return tableExclusions;</span>
    }

    /**
     * @return
     */
    public List&lt;String&gt; getSchemas() {
<span class="pc bpc" id="L978" title="1 of 2 branches missed.">        if (schemas == null) {</span>
<span class="fc" id="L979">            String tmp = pullParam(&quot;-schemas&quot;);</span>
<span class="pc bpc" id="L980" title="1 of 2 branches missed.">            if (tmp == null)</span>
<span class="fc" id="L981">                tmp = pullParam(&quot;-schemata&quot;);</span>
<span class="pc bpc" id="L982" title="1 of 2 branches missed.">            if (tmp != null) {</span>
<span class="nc" id="L983">                schemas = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L985" title="All 2 branches missed.">                for (String name : tmp.split(&quot;[\\s,'\&quot;]&quot;)) {</span>
<span class="nc bnc" id="L986" title="All 2 branches missed.">                    if (name.length() &gt; 0)</span>
<span class="nc" id="L987">                        schemas.add(name);</span>
                }

<span class="nc bnc" id="L990" title="All 2 branches missed.">                if (schemas.isEmpty())</span>
<span class="nc" id="L991">                    schemas = null;</span>
            }
        }

<span class="fc" id="L995">        return schemas;</span>
    }

    /**
     * Set the name of the {@link SqlFormatter SQL formatter} class to use to
     * format SQL into HTML.&lt;p/&gt;
     * The implementation of the class must be made available to the class
     * loader, typically by specifying the path to its jar with &lt;em&gt;-dp&lt;/em&gt;
     * ({@link #setDriverPath(String)}).
     */
    public void setSqlFormatter(String formatterClassName) {
<span class="fc" id="L1006">        sqlFormatterClass = formatterClassName;</span>
<span class="fc" id="L1007">        sqlFormatter = null;</span>
<span class="fc" id="L1008">    }</span>

    /**
     * Set the {@link SqlFormatter SQL formatter} to use to format
     * SQL into HTML.
     */
    public void setSqlFormatter(SqlFormatter sqlFormatter) {
<span class="fc" id="L1015">        this.sqlFormatter = sqlFormatter;</span>
<span class="pc bpc" id="L1016" title="1 of 2 branches missed.">        if (sqlFormatter != null)</span>
<span class="nc" id="L1017">            sqlFormatterClass = sqlFormatter.getClass().getName();</span>
<span class="fc" id="L1018">    }</span>

    /**
     * Returns an implementation of {@link SqlFormatter SQL formatter} to use to format
     * SQL into HTML.  The default implementation is {@link DefaultSqlFormatter}.
     *
     * @return
     * @throws InvalidConfigurationException if unable to instantiate an instance
     */
    @SuppressWarnings(&quot;unchecked&quot;)
    public SqlFormatter getSqlFormatter() throws InvalidConfigurationException {
<span class="pc bpc" id="L1029" title="1 of 2 branches missed.">        if (sqlFormatter == null) {</span>
<span class="pc bpc" id="L1030" title="1 of 2 branches missed.">            if (sqlFormatterClass == null) {</span>
<span class="fc" id="L1031">                sqlFormatterClass = pullParam(&quot;-sqlFormatter&quot;);</span>

<span class="pc bpc" id="L1033" title="1 of 2 branches missed.">                if (sqlFormatterClass == null)</span>
<span class="fc" id="L1034">                    sqlFormatterClass = DefaultSqlFormatter.class.getName();</span>
            }

            try {
<span class="fc" id="L1038">                Class&lt;SqlFormatter&gt; clazz = (Class&lt;SqlFormatter&gt;)Class.forName(sqlFormatterClass);</span>
<span class="fc" id="L1039">                sqlFormatter = clazz.newInstance();</span>
<span class="nc" id="L1040">            } catch (Exception exc) {</span>
<span class="nc" id="L1041">                throw new InvalidConfigurationException(&quot;Failed to initialize instance of SQL formatter: &quot;, exc)</span>
                            .setParamName(&quot;-sqlFormatter&quot;);
<span class="fc" id="L1043">            }</span>
        }

<span class="fc" id="L1046">        return sqlFormatter;</span>
    }

    /**
     * Set the details to show on the columns page, where &quot;details&quot; are
     * comma and/or space separated.
     *
     * Valid values:
     * &lt;ul&gt;
     * &lt;li&gt;id&lt;/li&gt;
     * &lt;li&gt;table&lt;/li&gt;
     * &lt;li&gt;column&lt;/li&gt;
     * &lt;li&gt;type&lt;/li&gt;
     * &lt;li&gt;size&lt;/li&gt;
     * &lt;li&gt;nulls&lt;/li&gt;
     * &lt;li&gt;auto&lt;/li&gt;
     * &lt;li&gt;default&lt;/li&gt;
     * &lt;li&gt;children&lt;/li&gt;
     * &lt;li&gt;parents&lt;/li&gt;
     * &lt;/ul&gt;
     *
     * The default details are &lt;code&gt;&quot;table column type size nulls auto default&quot;&lt;/code&gt;.
     * Note that &quot;column&quot; is the initially displayed detail and must be included.
     *
     * @param columnDetails
     */
    public void setColumnDetails(String columnDetails) {
<span class="fc" id="L1073">        this.columnDetails = new ArrayList&lt;String&gt;();</span>
<span class="fc bfc" id="L1074" title="All 4 branches covered.">        if (columnDetails == null || columnDetails.length() == 0) {</span>
            // not specified, so use defaults
<span class="fc" id="L1076">            columnDetails = &quot;id table column type size nulls auto default&quot;;</span>
        }

<span class="fc bfc" id="L1079" title="All 2 branches covered.">        for (String detail : columnDetails.split(&quot;[\\s,'\&quot;]&quot;)) {</span>
<span class="pc bpc" id="L1080" title="1 of 2 branches missed.">            if (detail.length() &gt; 0) {</span>
<span class="fc" id="L1081">                this.columnDetails.add(detail.toLowerCase());</span>
            }
        }

<span class="fc bfc" id="L1085" title="All 2 branches covered.">        if (!this.columnDetails.contains(&quot;column&quot;))</span>
<span class="fc" id="L1086">            throw new InvalidConfigurationException(&quot;'column' is a required column detail&quot;);</span>
<span class="fc" id="L1087">    }</span>

    public void setColumnDetails(List&lt;String&gt; columnDetails) {
<span class="pc bpc" id="L1090" title="1 of 2 branches missed.">        String details = columnDetails == null ? &quot;[]&quot; : columnDetails.toString();</span>
<span class="fc" id="L1091">        setColumnDetails(details.substring(1, details.length() - 1));</span>
<span class="fc" id="L1092">    }</span>

    public List&lt;String&gt; getColumnDetails() {
<span class="fc bfc" id="L1095" title="All 2 branches covered.">        if (columnDetails == null) {</span>
<span class="fc" id="L1096">            setColumnDetails(pullParam(&quot;-columndetails&quot;));</span>
        }

<span class="fc" id="L1099">        return columnDetails;</span>
    }

    public void setEvaluateAllEnabled(boolean enabled) {
<span class="fc" id="L1103">        evaluteAll = enabled;</span>
<span class="fc" id="L1104">    }</span>

    public boolean isEvaluateAllEnabled() {
<span class="fc bfc" id="L1107" title="All 2 branches covered.">        if (evaluteAll == null)</span>
<span class="fc" id="L1108">            evaluteAll = options.remove(&quot;-all&quot;);</span>
<span class="fc" id="L1109">        return evaluteAll;</span>
    }

    /**
     * Returns true if we're evaluating a bunch of schemas in one go and
     * at this point we're evaluating a specific schema.
     *
     * @return boolean
     */
    public boolean isOneOfMultipleSchemas() {
        // set by MultipleSchemaAnalyzer
<span class="fc" id="L1120">        return Boolean.getBoolean(&quot;oneofmultipleschemas&quot;);</span>
    }

    /**
     * When -all (evaluateAll) is specified then this is the regular
     * expression that determines which schemas to evaluate.
     *
     * @param schemaSpec
     */
    public void setSchemaSpec(String schemaSpec) {
<span class="fc" id="L1130">        this.schemaSpec = schemaSpec;</span>
<span class="fc" id="L1131">    }</span>

    public String getSchemaSpec() {
<span class="pc bpc" id="L1134" title="1 of 2 branches missed.">        if (schemaSpec == null)</span>
<span class="fc" id="L1135">            schemaSpec = pullParam(&quot;-schemaSpec&quot;);</span>

<span class="fc" id="L1137">        return schemaSpec;</span>
    }

    /**
     * Set the renderer to use for the -Tpng[:renderer[:formatter]] dot option as specified
     * at &lt;a href='http://www.graphviz.org/doc/info/command.html'&gt;
     * http://www.graphviz.org/doc/info/command.html&lt;/a&gt;.&lt;p&gt;
     * Note that the leading &quot;:&quot; is required while :formatter is optional.&lt;p&gt;
     * The default renderer is typically GD.&lt;p&gt;
     * Note that using {@link #setHighQuality(boolean)} is the preferred approach
     * over using this method.
     */
    public void setRenderer(String renderer) {
<span class="fc" id="L1150">        Dot.getInstance().setRenderer(renderer);</span>
<span class="fc" id="L1151">    }</span>

    /**
     * @see #setRenderer(String)
     * @return
     */
    public String getRenderer() {
<span class="fc" id="L1158">        String renderer = pullParam(&quot;-renderer&quot;);</span>
<span class="pc bpc" id="L1159" title="1 of 2 branches missed.">        if (renderer != null)</span>
<span class="nc" id="L1160">            setRenderer(renderer);</span>

<span class="fc" id="L1162">        return Dot.getInstance().getRenderer();</span>
    }

    /**
     * If &lt;code&gt;false&lt;/code&gt; then generate output of &quot;lower quality&quot;
     * than the default.
     * Note that the default is intended to be &quot;higher quality&quot;,
     * but various installations of Graphviz may have have different abilities.
     * That is, some might not have the &quot;lower quality&quot; libraries and others might
     * not have the &quot;higher quality&quot; libraries.&lt;p&gt;
     * Higher quality output takes longer to generate and results in significantly
     * larger image files (which take longer to download / display), but it generally
     * looks better.
     */
    public void setHighQuality(boolean highQuality) {
<span class="fc" id="L1177">        this.highQuality = highQuality;</span>
<span class="fc bfc" id="L1178" title="All 2 branches covered.">        lowQuality = !highQuality;</span>
<span class="fc" id="L1179">        Dot.getInstance().setHighQuality(highQuality);</span>
<span class="fc" id="L1180">    }</span>

    /**
     * @see #setHighQuality(boolean)
     */
    public boolean isHighQuality() {
<span class="fc bfc" id="L1186" title="All 2 branches covered.">        if (highQuality == null) {</span>
<span class="fc" id="L1187">            highQuality = options.remove(&quot;-hq&quot;);</span>
<span class="pc bpc" id="L1188" title="1 of 2 branches missed.">            if (highQuality) {</span>
                // use whatever is the default unless explicitly specified otherwise
<span class="nc" id="L1190">                Dot.getInstance().setHighQuality(highQuality);</span>
            }
        }

<span class="fc" id="L1194">        highQuality = Dot.getInstance().isHighQuality();</span>
<span class="fc" id="L1195">        return highQuality;</span>
    }

    /**
     * @see #setHighQuality(boolean)
     */
    public boolean isLowQuality() {
<span class="fc bfc" id="L1202" title="All 2 branches covered.">        if (lowQuality == null) {</span>
<span class="fc" id="L1203">            lowQuality = options.remove(&quot;-lq&quot;);</span>
<span class="pc bpc" id="L1204" title="1 of 2 branches missed.">            if (lowQuality) {</span>
                // use whatever is the default unless explicitly specified otherwise
<span class="nc bnc" id="L1206" title="All 2 branches missed.">                Dot.getInstance().setHighQuality(!lowQuality);</span>
            }
        }

<span class="pc bpc" id="L1210" title="1 of 2 branches missed.">        lowQuality = !Dot.getInstance().isHighQuality();</span>
<span class="fc" id="L1211">        return lowQuality;</span>
    }

    /**
     * Set the level of logging to perform.&lt;p/&gt;
     * The levels in descending order are:
     * &lt;ul&gt;
     *  &lt;li&gt;&lt;code&gt;severe&lt;/code&gt; (highest - least detail)
     *  &lt;li&gt;&lt;code&gt;warning&lt;/code&gt; (default)
     *  &lt;li&gt;&lt;code&gt;info&lt;/code&gt;
     *  &lt;li&gt;&lt;code&gt;config&lt;/code&gt;
     *  &lt;li&gt;&lt;code&gt;fine&lt;/code&gt;
     *  &lt;li&gt;&lt;code&gt;finer&lt;/code&gt;
     *  &lt;li&gt;&lt;code&gt;finest&lt;/code&gt;  (lowest - most detail)
     * &lt;/ul&gt;
     *
     * @param logLevel
     */
    public void setLogLevel(String logLevel) {
<span class="fc bfc" id="L1230" title="All 2 branches covered.">        if (logLevel == null) {</span>
<span class="fc" id="L1231">            this.logLevel = Level.WARNING;</span>
<span class="fc" id="L1232">            return;</span>
        }

<span class="fc" id="L1235">        Map&lt;String, Level&gt; levels = new LinkedHashMap&lt;String, Level&gt;();</span>
<span class="fc" id="L1236">        levels.put(&quot;severe&quot;, Level.SEVERE);</span>
<span class="fc" id="L1237">        levels.put(&quot;warning&quot;, Level.WARNING);</span>
<span class="fc" id="L1238">        levels.put(&quot;info&quot;, Level.INFO);</span>
<span class="fc" id="L1239">        levels.put(&quot;config&quot;, Level.CONFIG);</span>
<span class="fc" id="L1240">        levels.put(&quot;fine&quot;, Level.FINE);</span>
<span class="fc" id="L1241">        levels.put(&quot;finer&quot;, Level.FINER);</span>
<span class="fc" id="L1242">        levels.put(&quot;finest&quot;, Level.FINEST);</span>

<span class="fc" id="L1244">        this.logLevel = levels.get(logLevel.toLowerCase());</span>
<span class="pc bpc" id="L1245" title="1 of 2 branches missed.">        if (this.logLevel == null) {</span>
<span class="fc" id="L1246">            throw new InvalidConfigurationException(&quot;Invalid logLevel: '&quot; + logLevel +</span>
                    &quot;'. Must be one of: &quot; + levels.keySet());
        }
<span class="nc" id="L1249">    }</span>

    /**
     * Returns the level of logging to perform.
     * See {@link #setLogLevel(String)}.
     *
     * @return
     */
    public Level getLogLevel() {
<span class="fc bfc" id="L1258" title="All 2 branches covered.">        if (logLevel == null) {</span>
<span class="fc" id="L1259">            setLogLevel(pullParam(&quot;-loglevel&quot;));</span>
        }

<span class="fc" id="L1262">        return logLevel;</span>
    }

    /**
     * Returns &lt;code&gt;true&lt;/code&gt; if the options indicate that the user wants
     * to see some help information.
     *
     * @return
     */
    public boolean isHelpRequired() {
<span class="fc" id="L1272">        return helpRequired;</span>
    }

    public boolean isDbHelpRequired() {
<span class="fc" id="L1276">        return dbHelpRequired;</span>
    }

    /**
     * Returns the jar that we were loaded from
     *
     * @return
     */
    public static String getLoadedFromJar() {
<span class="fc" id="L1285">        String classpath = System.getProperty(&quot;java.class.path&quot;);</span>
<span class="fc" id="L1286">        return new StringTokenizer(classpath, File.pathSeparator).nextToken();</span>
    }

    /**
     * Not a true configuration item in that it's determined at runtime
     */
    public void setHasOrphans(boolean hasOrphans) {
<span class="fc" id="L1293">        this.hasOrphans = hasOrphans;</span>
<span class="fc" id="L1294">    }</span>

    /**
     * @see #setHasOrphans()
     *
     * @return
     */
    public boolean hasOrphans() {
<span class="fc" id="L1302">        return hasOrphans;</span>
    }

    /**
     * Not a true configuration item in that it's determined at runtime
     */
    public void setHasRoutines(boolean hasRoutines) {
<span class="fc" id="L1309">        this.hasRoutines = hasRoutines;</span>
<span class="fc" id="L1310">    }</span>

    /**
     * @see #setHasRoutines()
     *
     * @return
     */
    public boolean hasRoutines() {
<span class="fc" id="L1318">        return hasRoutines;</span>
    }

    /**
     * Returns the database properties to use.
     * These should be determined by calling {@link #determineDbProperties(String)}.
     * @return
     * @throws InvalidConfigurationException
     */
    public Properties getDbProperties() throws InvalidConfigurationException {
<span class="pc bpc" id="L1328" title="1 of 2 branches missed.">        if (dbProperties == null) {</span>
            try {
<span class="nc" id="L1330">                dbProperties = determineDbProperties(getDbType());</span>
<span class="fc" id="L1331">            } catch (IOException exc) {</span>
<span class="fc" id="L1332">                throw new InvalidConfigurationException(exc);</span>
<span class="nc" id="L1333">            }</span>
        }

<span class="nc" id="L1336">        return dbProperties;</span>
    }

    /**
     * Determines the database properties associated with the specified type.
     * A call to {@link #setDbProperties(Properties)} is expected after determining
     * the complete set of properties.
     *
     * @param type
     * @return
     * @throws IOException
     * @throws InvalidConfigurationException if db properties are incorrectly formed
     */
    public Properties determineDbProperties(String type) throws IOException, InvalidConfigurationException {
<span class="fc" id="L1350">        ResourceBundle bundle = null;</span>

        try {
<span class="fc" id="L1353">            File propertiesFile = new File(type);</span>
<span class="fc" id="L1354">            bundle = new PropertyResourceBundle(new FileInputStream(propertiesFile));</span>
<span class="fc" id="L1355">            dbPropertiesLoadedFrom = propertiesFile.getAbsolutePath();</span>
<span class="fc" id="L1356">        } catch (FileNotFoundException notFoundOnFilesystemWithoutExtension) {</span>
            try {
<span class="nc" id="L1358">                File propertiesFile = new File(type + &quot;.properties&quot;);</span>
<span class="nc" id="L1359">                bundle = new PropertyResourceBundle(new FileInputStream(propertiesFile));</span>
<span class="nc" id="L1360">                dbPropertiesLoadedFrom = propertiesFile.getAbsolutePath();</span>
<span class="fc" id="L1361">            } catch (FileNotFoundException notFoundOnFilesystemWithExtensionTackedOn) {</span>
                try {
<span class="nc" id="L1363">                    bundle = ResourceBundle.getBundle(type);</span>
<span class="nc" id="L1364">                    dbPropertiesLoadedFrom = &quot;[&quot; + getLoadedFromJar() + &quot;]&quot; + File.separator + type + &quot;.properties&quot;;</span>
<span class="fc" id="L1365">                } catch (Exception notInJarWithoutPath) {</span>
                    try {
<span class="nc" id="L1367">                        String path = TableOrderer.class.getPackage().getName() + &quot;.dbTypes.&quot; + type;</span>
<span class="nc" id="L1368">                        path = path.replace('.', '/');</span>
<span class="nc" id="L1369">                        bundle = ResourceBundle.getBundle(path);</span>
<span class="nc" id="L1370">                        dbPropertiesLoadedFrom = &quot;[&quot; + getLoadedFromJar() + &quot;]/&quot; + path + &quot;.properties&quot;;</span>
<span class="fc" id="L1371">                    } catch (Exception notInJar) {</span>
<span class="fc" id="L1372">                        notInJar.printStackTrace();</span>
<span class="fc" id="L1373">                        notFoundOnFilesystemWithExtensionTackedOn.printStackTrace();</span>
<span class="fc" id="L1374">                        throw notFoundOnFilesystemWithoutExtension;</span>
<span class="nc" id="L1375">                    }</span>
<span class="nc" id="L1376">                }</span>
<span class="nc" id="L1377">            }</span>
<span class="fc" id="L1378">        }</span>

<span class="fc" id="L1380">        Properties props = asProperties(bundle);</span>
<span class="fc" id="L1381">        bundle = null;</span>
<span class="fc" id="L1382">        String saveLoadedFrom = dbPropertiesLoadedFrom; // keep original thru recursion</span>

        // bring in key/values pointed to by the include directive
        // example: include.1=mysql::selectRowCountSql
<span class="pc" id="L1386">        for (int i = 1; true; ++i) {</span>
<span class="fc" id="L1387">            String include = (String)props.remove(&quot;include.&quot; + i);</span>
<span class="pc bpc" id="L1388" title="1 of 2 branches missed.">            if (include == null)</span>
<span class="fc" id="L1389">                break;</span>

<span class="nc" id="L1391">            int separator = include.indexOf(&quot;::&quot;);</span>
<span class="nc bnc" id="L1392" title="All 2 branches missed.">            if (separator == -1)</span>
<span class="nc" id="L1393">                throw new InvalidConfigurationException(&quot;include directive in &quot; + dbPropertiesLoadedFrom + &quot; must have '::' between dbType and key&quot;);</span>

<span class="nc" id="L1395">            String refdType = include.substring(0, separator).trim();</span>
<span class="nc" id="L1396">            String refdKey = include.substring(separator + 2).trim();</span>

            // recursively resolve the ref'd properties file and the ref'd key
<span class="nc" id="L1399">            Properties refdProps = determineDbProperties(refdType);</span>
<span class="nc" id="L1400">            props.put(refdKey, refdProps.getProperty(refdKey));</span>
        }

        // bring in base properties files pointed to by the extends directive
<span class="fc" id="L1404">        String baseDbType = (String)props.remove(&quot;extends&quot;);</span>
<span class="pc bpc" id="L1405" title="1 of 2 branches missed.">        if (baseDbType != null) {</span>
<span class="nc" id="L1406">            baseDbType = baseDbType.trim();</span>
<span class="nc" id="L1407">            Properties baseProps = determineDbProperties(baseDbType);</span>

            // overlay our properties on top of the base's
<span class="nc" id="L1410">            baseProps.putAll(props);</span>
<span class="nc" id="L1411">            props = baseProps;</span>
        }

        // done with this level of recursion...restore original
<span class="fc" id="L1415">        dbPropertiesLoadedFrom = saveLoadedFrom;</span>

        // this won't be correct until the final recursion exits
<span class="fc" id="L1418">        dbProperties = props;</span>

<span class="fc" id="L1420">        return props;</span>
    }

    protected String getDbPropertiesLoadedFrom() throws IOException {
<span class="nc bnc" id="L1424" title="All 2 branches missed.">        if (dbPropertiesLoadedFrom == null)</span>
<span class="nc" id="L1425">            determineDbProperties(getDbType());</span>
<span class="nc" id="L1426">        return dbPropertiesLoadedFrom;</span>
    }

    public List&lt;String&gt; getRemainingParameters()
    {
        try {
<span class="nc" id="L1432">            populate();</span>
<span class="nc" id="L1433">        } catch (IllegalArgumentException exc) {</span>
<span class="nc" id="L1434">            throw new InvalidConfigurationException(exc);</span>
<span class="nc" id="L1435">        } catch (IllegalAccessException exc) {</span>
<span class="nc" id="L1436">            throw new InvalidConfigurationException(exc);</span>
<span class="fc" id="L1437">        } catch (InvocationTargetException exc) {</span>
<span class="fc bfc" id="L1438" title="All 2 branches covered.">            if (exc.getCause() instanceof InvalidConfigurationException)</span>
<span class="fc" id="L1439">                throw (InvalidConfigurationException)exc.getCause();</span>
<span class="fc" id="L1440">            throw new InvalidConfigurationException(exc.getCause());</span>
<span class="nc" id="L1441">        } catch (IntrospectionException exc) {</span>
<span class="nc" id="L1442">            throw new InvalidConfigurationException(exc);</span>
<span class="nc" id="L1443">        }</span>

<span class="nc" id="L1445">        return options;</span>
    }

    /**
     * Options that are specific to a type of database.  E.g. things like &lt;code&gt;host&lt;/code&gt;,
     * &lt;code&gt;port&lt;/code&gt; or &lt;code&gt;db&lt;/code&gt;, but &lt;b&gt;don't&lt;/b&gt; have a setter in this class.
     *
     * @param dbSpecificOptions
     */
    public void setDbSpecificOptions(Map&lt;String, String&gt; dbSpecificOptions) {
<span class="nc" id="L1455">        this.dbSpecificOptions = dbSpecificOptions;</span>
<span class="nc" id="L1456">        originalDbSpecificOptions = new HashMap&lt;String, String&gt;(dbSpecificOptions);</span>
<span class="nc" id="L1457">    }</span>

    public Map&lt;String, String&gt; getDbSpecificOptions() {
<span class="pc bpc" id="L1460" title="1 of 2 branches missed.">        if (dbSpecificOptions ==  null)</span>
<span class="fc" id="L1461">            dbSpecificOptions = new HashMap&lt;String, String&gt;();</span>
<span class="fc" id="L1462">        return dbSpecificOptions;</span>
    }

    /**
     * Returns a {@link Properties} populated with the contents of &lt;code&gt;bundle&lt;/code&gt;
     *
     * @param bundle ResourceBundle
     * @return Properties
     */
    public static Properties asProperties(ResourceBundle bundle) {
<span class="fc" id="L1472">        Properties props = new Properties();</span>
<span class="fc" id="L1473">        Enumeration&lt;String&gt; iter = bundle.getKeys();</span>
<span class="pc bpc" id="L1474" title="1 of 2 branches missed.">        while (iter.hasMoreElements()) {</span>
<span class="nc" id="L1475">            String key = iter.nextElement();</span>
<span class="nc" id="L1476">            props.put(key, bundle.getObject(key));</span>
<span class="nc" id="L1477">        }</span>

<span class="fc" id="L1479">        return props;</span>
    }

    /**
     * 'Pull' the specified parameter from the collection of options. Returns
     * null if the parameter isn't in the list and removes it if it is.
     *
     * @param paramId
     * @return
     */
    private String pullParam(String paramId) {
<span class="fc" id="L1490">        return pullParam(paramId, false, false);</span>
    }

    private String pullRequiredParam(String paramId) {
<span class="nc" id="L1494">        return pullParam(paramId, true, false);</span>
    }

    /**
     * @param paramId
     * @param required
     * @param dbTypeSpecific
     * @return
     * @throws MissingRequiredParameterException
     */
    private String pullParam(String paramId, boolean required, boolean dbTypeSpecific)
                                throws MissingRequiredParameterException {
<span class="fc" id="L1506">        int paramIndex = options.indexOf(paramId);</span>
<span class="pc bpc" id="L1507" title="1 of 2 branches missed.">        if (paramIndex &lt; 0) {</span>
<span class="fc bfc" id="L1508" title="All 2 branches covered.">            if (required)</span>
<span class="fc" id="L1509">                throw new MissingRequiredParameterException(paramId, dbTypeSpecific);</span>
<span class="fc" id="L1510">            return null;</span>
        }
<span class="nc" id="L1512">        options.remove(paramIndex);</span>
<span class="nc" id="L1513">        String param = options.get(paramIndex).toString();</span>
<span class="nc" id="L1514">        options.remove(paramIndex);</span>
<span class="nc" id="L1515">        return param;</span>
    }

    /**
     * Thrown to indicate that a required parameter is missing
     */
    public static class MissingRequiredParameterException extends RuntimeException {
        private static final long serialVersionUID = 1L;
        private final boolean dbTypeSpecific;

        public MissingRequiredParameterException(String paramId, boolean dbTypeSpecific) {
<span class="fc" id="L1526">            this(paramId, null, dbTypeSpecific);</span>
<span class="fc" id="L1527">        }</span>

        public MissingRequiredParameterException(String paramId, String description, boolean dbTypeSpecific) {
<span class="pc bpc" id="L1530" title="2 of 4 branches missed.">            super(&quot;Required parameter '&quot; + paramId + &quot;' &quot; +</span>
                    (description == null ? &quot;&quot; : &quot;(&quot; + description + &quot;) &quot;) +
                    &quot;was not specified.&quot; +
                    (dbTypeSpecific ? &quot;  It is required for this database type.&quot; : &quot;&quot;));
<span class="fc" id="L1534">            this.dbTypeSpecific = dbTypeSpecific;</span>
<span class="fc" id="L1535">        }</span>

        public boolean isDbTypeSpecific() {
<span class="fc" id="L1538">            return dbTypeSpecific;</span>
        }
    }

    /**
     * Allow an equal sign in args...like &quot;-o=foo.bar&quot;. Useful for things like
     * Ant and Maven.
     *
     * @param args
     *            List
     * @return List
     */
    protected List&lt;String&gt; fixupArgs(List&lt;String&gt; args) {
<span class="fc" id="L1551">        List&lt;String&gt; expandedArgs = new ArrayList&lt;String&gt;();</span>

<span class="fc bfc" id="L1553" title="All 2 branches covered.">        for (String arg : args) {</span>
<span class="fc" id="L1554">            int indexOfEquals = arg.indexOf('=');</span>
<span class="pc bpc" id="L1555" title="3 of 4 branches missed.">            if (indexOfEquals != -1 &amp;&amp; indexOfEquals -1 != arg.indexOf(ESCAPED_EQUALS)) {</span>
<span class="nc" id="L1556">                expandedArgs.add(arg.substring(0, indexOfEquals));</span>
<span class="nc" id="L1557">                expandedArgs.add(arg.substring(indexOfEquals + 1));</span>
            } else {
<span class="fc" id="L1559">                expandedArgs.add(arg);</span>
            }
<span class="fc" id="L1561">        }</span>

        // some OSes/JVMs do filename expansion with runtime.exec() and some don't,
        // so MultipleSchemaAnalyzer has to surround params with double quotes...
        // strip them here for the OSes/JVMs that don't do anything with the params
<span class="fc" id="L1566">        List&lt;String&gt; unquotedArgs = new ArrayList&lt;String&gt;();</span>

<span class="fc bfc" id="L1568" title="All 2 branches covered.">        for (String arg : expandedArgs) {</span>
<span class="pc bpc" id="L1569" title="3 of 4 branches missed.">            if (arg.startsWith(&quot;\&quot;&quot;) &amp;&amp; arg.endsWith(&quot;\&quot;&quot;))  // &quot;.*&quot; becomes .*</span>
<span class="nc" id="L1570">                arg = arg.substring(1, arg.length() - 1);</span>
<span class="fc" id="L1571">            unquotedArgs.add(arg);</span>
<span class="fc" id="L1572">        }</span>

<span class="fc" id="L1574">        return unquotedArgs;</span>
    }

    /**
     * Call all the getters to populate all the lazy initialized stuff.
     *
     * @throws InvocationTargetException
     * @throws IllegalAccessException
     * @throws IllegalArgumentException
     * @throws IntrospectionException
     */
    private void populate() throws IllegalArgumentException, IllegalAccessException, InvocationTargetException, IntrospectionException {
<span class="pc bpc" id="L1586" title="1 of 2 branches missed.">        if (!populating) { // prevent recursion</span>
<span class="fc" id="L1587">            populating = true;</span>

<span class="fc" id="L1589">            BeanInfo beanInfo = Introspector.getBeanInfo(Config.class);</span>
<span class="fc" id="L1590">            PropertyDescriptor[] props = beanInfo.getPropertyDescriptors();</span>
<span class="pc bpc" id="L1591" title="1 of 2 branches missed.">            for (int i = 0; i &lt; props.length; ++i) {</span>
<span class="fc" id="L1592">                Method readMethod = props[i].getReadMethod();</span>
<span class="pc bpc" id="L1593" title="1 of 2 branches missed.">                if (readMethod != null)</span>
<span class="fc" id="L1594">                    readMethod.invoke(this, (Object[])null);</span>
            }

<span class="nc" id="L1597">            populating = false;</span>
        }
<span class="nc" id="L1599">    }</span>

    public static Set&lt;String&gt; getBuiltInDatabaseTypes(String loadedFromJar) {
<span class="fc" id="L1602">        Set&lt;String&gt; databaseTypes = new TreeSet&lt;String&gt;();</span>
<span class="fc" id="L1603">        JarInputStream jar = null;</span>

        try {
<span class="nc" id="L1606">            jar = new JarInputStream(new FileInputStream(loadedFromJar));</span>
            JarEntry entry;

<span class="nc bnc" id="L1609" title="All 2 branches missed.">            while ((entry = jar.getNextJarEntry()) != null) {</span>
<span class="nc" id="L1610">                String entryName = entry.getName();</span>
<span class="nc" id="L1611">                int dotPropsIndex = entryName.indexOf(&quot;.properties&quot;);</span>
<span class="nc bnc" id="L1612" title="All 2 branches missed.">                if (dotPropsIndex != -1)</span>
<span class="nc" id="L1613">                    databaseTypes.add(entryName.substring(0, dotPropsIndex));</span>
<span class="nc" id="L1614">            }</span>
<span class="fc" id="L1615">        } catch (IOException exc) {</span>
        } finally {
<span class="pc bpc" id="L1617" title="5 of 6 branches missed.">            if (jar != null) {</span>
                try {
<span class="nc" id="L1619">                    jar.close();</span>
<span class="nc" id="L1620">                } catch (IOException ignore) {}</span>
            }
        }

<span class="fc" id="L1624">        return databaseTypes;</span>
    }

    protected void dumpUsage(String errorMessage, boolean detailedDb) {
<span class="fc bfc" id="L1628" title="All 2 branches covered.">        if (errorMessage != null) {</span>
<span class="fc" id="L1629">            System.out.flush();</span>
<span class="fc" id="L1630">            System.err.println(&quot;*** &quot; + errorMessage + &quot; ***&quot;);</span>
        } else {
<span class="fc" id="L1632">            System.out.println(&quot;SchemaSpy generates an HTML representation of a database schema's relationships.&quot;);</span>
        }

<span class="fc" id="L1635">        System.err.flush();</span>
<span class="fc" id="L1636">        System.out.println();</span>

<span class="fc bfc" id="L1638" title="All 2 branches covered.">        if (!detailedDb) {</span>
<span class="fc" id="L1639">            System.out.println(&quot;Usage:&quot;);</span>
<span class="fc" id="L1640">            System.out.println(&quot; java -jar &quot; + getLoadedFromJar() + &quot; [options]&quot;);</span>
<span class="fc" id="L1641">            System.out.println(&quot;   -t databaseType       type of database - defaults to ora&quot;);</span>
<span class="fc" id="L1642">            System.out.println(&quot;                           use -dbhelp for a list of built-in types&quot;);</span>
<span class="fc" id="L1643">            System.out.println(&quot;   -u user               connect to the database with this user id&quot;);</span>
<span class="fc" id="L1644">            System.out.println(&quot;   -s schema             defaults to the specified user&quot;);</span>
<span class="fc" id="L1645">            System.out.println(&quot;   -p password           defaults to no password&quot;);</span>
<span class="fc" id="L1646">            System.out.println(&quot;   -o outputDirectory    directory to place the generated output in&quot;);</span>
<span class="fc" id="L1647">            System.out.println(&quot;   -dp pathToDrivers     optional - looks for JDBC drivers here before looking&quot;);</span>
<span class="fc" id="L1648">            System.out.println(&quot;                           in driverPath in [databaseType].properties.&quot;);</span>
<span class="fc" id="L1649">            System.out.println(&quot;Go to http://schemaspy.sourceforge.net for a complete list/description&quot;);</span>
<span class="fc" id="L1650">            System.out.println(&quot; of additional parameters.&quot;);</span>
<span class="fc" id="L1651">            System.out.println();</span>
        }

<span class="fc bfc" id="L1654" title="All 2 branches covered.">        if (detailedDb) {</span>
<span class="fc" id="L1655">            System.out.println(&quot;Built-in database types and their required connection parameters:&quot;);</span>
<span class="pc bpc" id="L1656" title="1 of 2 branches missed.">            for (String type : getBuiltInDatabaseTypes(getLoadedFromJar())) {</span>
<span class="nc" id="L1657">                new DbSpecificConfig(type).dumpUsage();</span>
<span class="nc" id="L1658">            }</span>
<span class="fc" id="L1659">            System.out.println();</span>
        }

<span class="fc bfc" id="L1662" title="All 2 branches covered.">        if (detailedDb) {</span>
<span class="fc" id="L1663">            System.out.println(&quot;You can use your own database types by specifying the filespec of a .properties file with -t.&quot;);</span>
<span class="fc" id="L1664">            System.out.println(&quot;Grab one out of &quot; + getLoadedFromJar() + &quot; and modify it to suit your needs.&quot;);</span>
<span class="fc" id="L1665">            System.out.println();</span>
        }

<span class="fc" id="L1668">        System.out.println(&quot;Sample usage using the default database type (implied -t ora):&quot;);</span>
<span class="fc" id="L1669">        System.out.println(&quot; java -jar schemaSpy.jar -db mydb -s myschema -u devuser -p password -o output&quot;);</span>
<span class="fc" id="L1670">        System.out.println();</span>
<span class="fc" id="L1671">        System.out.flush();</span>
<span class="fc" id="L1672">    }</span>

    /**
     * Get the value of the specified parameter.
     * Used for properties that are common to most db's, but aren't required.
     *
     * @param paramName
     * @return
     */
    public String getParam(String paramName) {
        try {
<span class="fc" id="L1683">            BeanInfo beanInfo = Introspector.getBeanInfo(Config.class);</span>
<span class="fc" id="L1684">            PropertyDescriptor[] props = beanInfo.getPropertyDescriptors();</span>
<span class="fc bfc" id="L1685" title="All 2 branches covered.">            for (int i = 0; i &lt; props.length; ++i) {</span>
<span class="fc" id="L1686">                PropertyDescriptor prop = props[i];</span>
<span class="pc bpc" id="L1687" title="1 of 2 branches missed.">                if (prop.getName().equalsIgnoreCase(paramName)) {</span>
<span class="nc" id="L1688">                    Object result = prop.getReadMethod().invoke(this, (Object[])null);</span>
<span class="nc bnc" id="L1689" title="All 2 branches missed.">                    return result == null ? null : result.toString();</span>
                }
            }
<span class="nc" id="L1692">        } catch (Exception failed) {</span>
<span class="nc" id="L1693">            failed.printStackTrace();</span>
<span class="fc" id="L1694">        }</span>

<span class="fc" id="L1696">        return null;</span>
    }

    /**
     * Return all of the configuration options as a List of Strings, with
     * each parameter and its value as a separate element.
     *
     * @return
     * @throws IOException
     */
    public List&lt;String&gt; asList() throws IOException {
<span class="fc" id="L1707">        List&lt;String&gt; params = new ArrayList&lt;String&gt;();</span>

<span class="pc bpc" id="L1709" title="1 of 2 branches missed.">        if (originalDbSpecificOptions != null) {</span>
<span class="nc bnc" id="L1710" title="All 2 branches missed.">            for (String key : originalDbSpecificOptions.keySet()) {</span>
<span class="nc" id="L1711">                String value = originalDbSpecificOptions.get(key);</span>
<span class="nc bnc" id="L1712" title="All 2 branches missed.">                if (!key.startsWith(&quot;-&quot;))</span>
<span class="nc" id="L1713">                    key = &quot;-&quot; + key;</span>
<span class="nc" id="L1714">                params.add(key);</span>
<span class="nc" id="L1715">                params.add(value);</span>
<span class="nc" id="L1716">            }</span>
        }

<span class="pc bpc" id="L1719" title="1 of 2 branches missed.">        if (isEncodeCommentsEnabled())</span>
<span class="fc" id="L1720">            params.add(&quot;-ahic&quot;);</span>
<span class="pc bpc" id="L1721" title="1 of 2 branches missed.">        if (isEvaluateAllEnabled())</span>
<span class="nc" id="L1722">            params.add(&quot;-all&quot;);</span>
<span class="pc bpc" id="L1723" title="1 of 2 branches missed.">        if (!isHtmlGenerationEnabled())</span>
<span class="nc" id="L1724">            params.add(&quot;-nohtml&quot;);</span>
<span class="pc bpc" id="L1725" title="1 of 2 branches missed.">        if (!isImpliedConstraintsEnabled())</span>
<span class="nc" id="L1726">            params.add(&quot;-noimplied&quot;);</span>
<span class="pc bpc" id="L1727" title="1 of 2 branches missed.">        if (!isLogoEnabled())</span>
<span class="nc" id="L1728">            params.add(&quot;-nologo&quot;);</span>
<span class="pc bpc" id="L1729" title="1 of 2 branches missed.">        if (isMeterEnabled())</span>
<span class="nc" id="L1730">            params.add(&quot;-meter&quot;);</span>
<span class="pc bpc" id="L1731" title="1 of 2 branches missed.">        if (!isNumRowsEnabled())</span>
<span class="nc" id="L1732">            params.add(&quot;-norows&quot;);</span>
<span class="pc bpc" id="L1733" title="1 of 2 branches missed.">        if (!isViewsEnabled())</span>
<span class="nc" id="L1734">            params.add(&quot;-noviews&quot;);</span>
<span class="pc bpc" id="L1735" title="1 of 2 branches missed.">        if (isRankDirBugEnabled())</span>
<span class="nc" id="L1736">            params.add(&quot;-rankdirbug&quot;);</span>
<span class="pc bpc" id="L1737" title="1 of 2 branches missed.">        if (isRailsEnabled())</span>
<span class="nc" id="L1738">            params.add(&quot;-rails&quot;);</span>
<span class="pc bpc" id="L1739" title="1 of 2 branches missed.">        if (isSingleSignOn())</span>
<span class="nc" id="L1740">            params.add(&quot;-sso&quot;);</span>
<span class="pc bpc" id="L1741" title="1 of 2 branches missed.">        if (isSchemaDisabled())</span>
<span class="nc" id="L1742">            params.add(&quot;-noschema&quot;);</span>

<span class="fc" id="L1744">        String value = getDriverPath();</span>
<span class="pc bpc" id="L1745" title="1 of 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1746">            params.add(&quot;-dp&quot;);</span>
<span class="nc" id="L1747">            params.add(value);</span>
        }
<span class="fc" id="L1749">        params.add(&quot;-css&quot;);</span>
<span class="fc" id="L1750">        params.add(getCss());</span>
<span class="fc" id="L1751">        params.add(&quot;-charset&quot;);</span>
<span class="fc" id="L1752">        params.add(getCharset());</span>
<span class="fc" id="L1753">        params.add(&quot;-font&quot;);</span>
<span class="fc" id="L1754">        params.add(getFont());</span>
<span class="fc" id="L1755">        params.add(&quot;-fontsize&quot;);</span>
<span class="fc" id="L1756">        params.add(String.valueOf(getFontSize()));</span>
<span class="fc" id="L1757">        params.add(&quot;-t&quot;);</span>
<span class="fc" id="L1758">        params.add(getDbType());</span>
<span class="fc" id="L1759">        isHighQuality();    // query to set renderer correctly</span>
<span class="fc" id="L1760">        isLowQuality();     // query to set renderer correctly</span>
<span class="fc" id="L1761">        params.add(&quot;-renderer&quot;);  // instead of -hq and/or -lq</span>
<span class="fc" id="L1762">        params.add(getRenderer());</span>
<span class="fc" id="L1763">        value = getDescription();</span>
<span class="pc bpc" id="L1764" title="1 of 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1765">            params.add(&quot;-desc&quot;);</span>
<span class="nc" id="L1766">            params.add(value);</span>
        }
<span class="fc" id="L1768">        value = getPassword();</span>
<span class="pc bpc" id="L1769" title="3 of 4 branches missed.">        if (value != null &amp;&amp; !isPromptForPasswordEnabled()) {</span>
            // note that we don't pass -pfp since child processes
            // won't have a console
<span class="nc" id="L1772">            params.add(&quot;-p&quot;);</span>
<span class="nc" id="L1773">            params.add(value);</span>
        }
<span class="fc" id="L1775">        value = getCatalog();</span>
<span class="pc bpc" id="L1776" title="1 of 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1777">            params.add(&quot;-cat&quot;);</span>
<span class="nc" id="L1778">            params.add(value);</span>
        }
<span class="fc" id="L1780">        value = getSchema();</span>
<span class="pc bpc" id="L1781" title="1 of 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1782">            params.add(&quot;-s&quot;);</span>
<span class="nc" id="L1783">            params.add(value);</span>
        }
<span class="nc" id="L1785">        value = getUser();</span>
<span class="nc bnc" id="L1786" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1787">            params.add(&quot;-u&quot;);</span>
<span class="nc" id="L1788">            params.add(value);</span>
        }
<span class="nc" id="L1790">        value = getConnectionPropertiesFile();</span>
<span class="nc bnc" id="L1791" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1792">            params.add(&quot;-connprops&quot;);</span>
<span class="nc" id="L1793">            params.add(value);</span>
        } else {
<span class="nc" id="L1795">            Properties props = getConnectionProperties();</span>
<span class="nc bnc" id="L1796" title="All 2 branches missed.">            if (!props.isEmpty() ) {</span>
<span class="nc" id="L1797">                params.add(&quot;-connprops&quot;);</span>
<span class="nc" id="L1798">                StringBuilder buf = new StringBuilder();</span>
<span class="nc bnc" id="L1799" title="All 2 branches missed.">                for (Entry&lt;Object, Object&gt; entry : props.entrySet()) {</span>
<span class="nc" id="L1800">                    buf.append(entry.getKey());</span>
<span class="nc" id="L1801">                    buf.append(ESCAPED_EQUALS);</span>
<span class="nc" id="L1802">                    buf.append(entry.getValue());</span>
<span class="nc" id="L1803">                    buf.append(';');</span>
<span class="nc" id="L1804">                }</span>
<span class="nc" id="L1805">                params.add(buf.toString());</span>
            }
        }
<span class="nc" id="L1808">        value = getDb();</span>
<span class="nc bnc" id="L1809" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1810">            params.add(&quot;-db&quot;);</span>
<span class="nc" id="L1811">            params.add(value);</span>
        }
<span class="nc" id="L1813">        value = getHost();</span>
<span class="nc bnc" id="L1814" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1815">            params.add(&quot;-host&quot;);</span>
<span class="nc" id="L1816">            params.add(value);</span>
        }
<span class="nc bnc" id="L1818" title="All 2 branches missed.">        if (getPort() != null) {</span>
<span class="nc" id="L1819">            params.add(&quot;-port&quot;);</span>
<span class="nc" id="L1820">            params.add(getPort().toString());</span>
        }
<span class="nc" id="L1822">        value = getServer();</span>
<span class="nc bnc" id="L1823" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1824">            params.add(&quot;-server&quot;);</span>
<span class="nc" id="L1825">            params.add(value);</span>
        }
<span class="nc" id="L1827">        value = getMeta();</span>
<span class="nc bnc" id="L1828" title="All 2 branches missed.">        if (value != null) {</span>
<span class="nc" id="L1829">            params.add(&quot;-meta&quot;);</span>
<span class="nc" id="L1830">            params.add(value);</span>
        }
<span class="nc bnc" id="L1832" title="All 2 branches missed.">        if (getGraphvizDir() != null) {</span>
<span class="nc" id="L1833">            params.add(&quot;-gv&quot;);</span>
<span class="nc" id="L1834">            params.add(getGraphvizDir().toString());</span>
        }
<span class="nc" id="L1836">        params.add(&quot;-loglevel&quot;);</span>
<span class="nc" id="L1837">        params.add(getLogLevel().toString().toLowerCase());</span>
<span class="nc" id="L1838">        params.add(&quot;-sqlFormatter&quot;);</span>
<span class="nc" id="L1839">        params.add(getSqlFormatter().getClass().getName());</span>
<span class="nc" id="L1840">        params.add(&quot;-i&quot;);</span>
<span class="nc" id="L1841">        params.add(getTableInclusions().toString());</span>
<span class="nc" id="L1842">        params.add(&quot;-I&quot;);</span>
<span class="nc" id="L1843">        params.add(getTableExclusions().toString());</span>
<span class="nc" id="L1844">        params.add(&quot;-X&quot;);</span>
<span class="nc" id="L1845">        params.add(getColumnExclusions().toString());</span>
<span class="nc" id="L1846">        params.add(&quot;-x&quot;);</span>
<span class="nc" id="L1847">        params.add(getIndirectColumnExclusions().toString());</span>
<span class="nc" id="L1848">        params.add(&quot;-dbthreads&quot;);</span>
<span class="nc" id="L1849">        params.add(String.valueOf(getMaxDbThreads()));</span>
<span class="nc" id="L1850">        params.add(&quot;-maxdet&quot;);</span>
<span class="nc" id="L1851">        params.add(String.valueOf(getMaxDetailedTables()));</span>
<span class="nc" id="L1852">        params.add(&quot;-o&quot;);</span>
<span class="nc" id="L1853">        params.add(getOutputDir().toString());</span>

<span class="nc" id="L1855">        return params;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201405220205</span></div></body></html>